"0","# Come up with new colnames"
"0","new_names <- c(""sample_group"", ""genes"")"
"0","for (i in 3:ncol(proteomics_raw)) {"
"0","  strain_and_batch <- colnames(proteomics_raw)[i]"
"0","  trna_name <- proteomics_raw[1, i]"
"0","  batch_num <- str_extract(strain_and_batch, ""(?<=\\.).*"")"
"0","  new_name <- paste(trna_name, ""_"", batch_num, sep = """")"
"0","  new_names <- c(new_names, new_name)"
"0","}"
"0","colnames(proteomics_raw) <- new_names"
"0",""
"0",""
"0","# Fix the situation with 2 tRNA_KOs being present twice (so 6 replicates for each instead of 3) - just going to take the average between the replicated samples"
"0","## Come up with the averages"
"0","n_occur <- data.frame(table(colnames(proteomics_raw)))"
"0","repeated_samples <- as.character(n_occur$Var1)[n_occur$Freq > 1]"
"0",""
"0","out_temp <- data.frame(matrix(ncol = 0, nrow = nrow(proteomics_raw)))"
"0","for (i in 1:length(repeated_samples)) {"
"0","  strain <- repeated_samples[i]"
"0","  temp <- proteomics_raw[5:nrow(proteomics_raw), colnames(proteomics_raw) == strain]"
"0","  temp[,1] <- as.numeric(temp[,1])"
"0","  temp[,2] <- as.numeric(temp[,2])"
"0","  first_rows <- proteomics_raw[1:4, colnames(proteomics_raw) == strain]"
"0","  out <- c(first_rows[,1], apply(temp, 1, mean))"
"0","  out_temp[,i] <- out"
"0","}"
"0","colnames(out_temp) <- repeated_samples"
"0",""
"0","## Remove original columns from dataframe and add the averaged ones"
"0","proteomics_raw <- proteomics_raw[,!(colnames(proteomics_raw) %in% repeated_samples)]"
"0","proteomics_raw <- cbind(proteomics_raw, out_temp)"
"0",""
"0",""
"0","# Format data to get a biological protein abundance dataframe with samples names as colnames and gene names as rownames"
"0","trna_ko <- proteomics_raw %>%                 "
"0","  filter(!(genes %in% c('', 'Genes', 'Protein.Group'))) %>%         # Remove rows for which ""genes"" column is empty or has ""Genes"" as value"
"0","  select(-sample_group & !contains('QC')) %>%                       # Remove UNIPROT IDs and QCs columns"
"0","  column_to_rownames(var = 'genes')                                 # Convert gene name column to rownames"
"0",""
"0","# Convert to a numeric dataframe"
"0","trna_ko <- as.data.frame(apply(trna_ko, 2, as.numeric), row.names =  rownames(trna_ko))   "
"0",""
"0","# Add sample_names to sample_layout so that we can filter out in the next line"
"0","sample_layout <- sample_layout %>%"
"0","  mutate(sample_names = case_when(Strain.ID == ""WT"" ~ paste(gsub(""-"", ""_"", Sample.ID), "".0"", Replicate, sep=""""),"
"0","                                  TRUE ~ paste(Strain.Name, ""_0"", Replicate, sep=""""))) "
"0",""
"0","# Remove the sub-batch that went wrong"
"0","samples_in_wrong_batch <- sample_layout$sample_names[sample_layout$Analysis.Plate.96_Replicate == ""3_2""]"
"0","trna_ko <- trna_ko[,!(colnames(trna_ko) %in% samples_in_wrong_batch)]"
"0",""
"0","# Remove unnecessary objects"
"0","rm(proteomics_raw, n_occur, repeated_samples, out_temp, strain, temp, first_rows, out, batch_num, i, new_name, new_names, strain_and_batch, trna_name,"
"0","   samples_in_wrong_batch)"
